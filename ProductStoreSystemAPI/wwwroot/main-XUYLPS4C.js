import{a as je}from"./chunk-752LFKQA.js";import{a as ye,b as A,c as b,d as f}from"./chunk-AJIENL2M.js";import{A as _e,B as Ie,D as Fe,F as Re,G as we,I as Me,J as Ee,W as Le,X as De,Y as ke,_ as Pe,c as ae,d as se,da as Ne,e as ce,f as le,fa as D,g as ue,h as he,i as me,j as de,k as w,l as pe,m as fe,n as ge,o as ve,p as Se,s as M,u as Ae,v as be,w as Ce,x as E,y as xe,z as L}from"./chunk-SDNPWJZK.js";import{$ as j,Bb as te,Da as Z,Eb as y,Gb as C,Hc as R,Qb as ie,Ra as X,Rb as c,Sb as T,T as B,Ta as l,Tb as H,Ua as h,V as S,Va as J,Xa as K,Y as V,Yb as F,Za as Q,_ as v,ab as ee,ac as re,da as I,ga as q,ha as G,ib as d,ic as ne,ma as W,mb as u,na as $,va as Y,vb as s,wb as o,x as U,xb as p,zc as oe}from"./chunk-3SPXI7PS.js";import{a as x,f as _}from"./chunk-RNMDN42R.js";var P=(()=>{class r{apiAuthService;router;constructor(e,t){this.apiAuthService=e,this.router=t}canActivate(e){return typeof window<"u"?localStorage.getItem("token")?this.apiAuthService.getUserRole()?!0:(this.router.navigate(["auth"]),!1):(this.router.navigate(["auth"]),!1):(this.router.navigate(["auth"]),!1)}static \u0275fac=function(t){return new(t||r)(v(f),v(w))};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var N=(()=>{class r{signalrService;apiAuthService;router;constructor(e,t,n){this.signalrService=e,this.apiAuthService=t,this.router=n}logout(){this.signalrService.hubConnection.invoke("LogoutUser",this.signalrService.userData.id).catch(e=>console.error(e))}logoutResponse(){this.signalrService.hubConnection.on("Logout_Response",()=>{localStorage.removeItem("token"),this.apiAuthService.checkAuthentication(),location.reload(),this.signalrService.hubConnection.stop()})}authentificationProcess(){this.signalrService.hubConnection&&(this.signalrService.hubConnection.state===A.Connected?(this.reAuthentificationListenerSuccess(),this.reAuthentification()):this.signalrService.signalrSubject$.subscribe(e=>{e.type=="HubConnectionStarted"&&(this.reAuthentificationListenerSuccess(),this.reAuthentification())}))}launchHub(e){this.signalrService.startConnection(e).then(()=>{this.authentification(this.signalrService.userData.id,this.signalrService.userData.name),this.authentificationProcess(),this.authentificationListenerSuccess(),this.authentificationListenerFail(),this.registrationListenerSuccess(),this.registrationListenerFail(),this.logoutResponse(),this.signalrService.offConnection(["Authentification_ResponseSuccess","Authentification_Fail","Registration_Fail","ngOnDestroy in app"])}).catch(t=>{console.error("Error starting SignalR connection:",t)})}authentification(e,t){return _(this,null,function*(){let n={email:e,password:t};yield this.signalrService.hubConnection.invoke("Authentification",n).then(()=>{console.log("siganlr authentification")}).catch(a=>console.log(a))})}authentificationListenerSuccess(){this.signalrService.hubConnection&&this.signalrService.hubConnection.state===A.Connected?this.signalrService.hubConnection.on("Authentification_ResponseSuccess",e=>{console.log("siganlr authentification back from server"),console.log(e),this.signalrService.userData=x({},e),localStorage.setItem("token",e.id.toString()),this.router.navigate(["/edit-products"])}):console.error("Hub connection is not in a connected state.")}reAuthentification(){return _(this,null,function*(){try{let e=this.apiAuthService.getUserId();yield this.signalrService.hubConnection.invoke("ReAuthentification",e).then(()=>{}).catch(t=>console.log(t))}catch(e){console.log(e)}})}reAuthentificationListenerSuccess(){try{this.signalrService.hubConnection&&this.signalrService.hubConnection.state===A.Connected?this.signalrService.hubConnection.on("ReAuthentification_ResponseSuccess",e=>{this.signalrService.userData=x({},e),this.router.url=="/auth"&&this.router.navigate(["/edit-products"])}):console.error("Hub connection is not in a connected state.")}catch(e){console.log(e)}}registration(e){return _(this,null,function*(){yield this.signalrService.hubConnection.invoke("Registration",e).then(()=>{alert("Loading is attempt...")}).catch(t=>console.log(t))})}registrationListenerSuccess(){this.signalrService.hubConnection&&this.signalrService.hubConnection.state===A.Connected?this.signalrService.hubConnection.on("Registration_ResponseSuccess",e=>{this.signalrService.userData=x({},e),localStorage.setItem("token",e.id.toString()),this.router.navigate(["/edit-products"])}):console.error("Hub connection is not in a connected state.")}authentificationListenerFail(){this.signalrService.hubConnection.on("Authentification_Fail",()=>alert("Wrong credentials!"))}registrationListenerFail(){this.signalrService.hubConnection.on("Registration_Fail",()=>alert("Such email already taken."))}static \u0275fac=function(t){return new(t||r)(v(b),v(f),v(w))};static \u0275prov=S({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Ze(r,i){r&1&&(s(0,"mat-error"),c(1,"Email is required."),o())}function Xe(r,i){r&1&&(s(0,"mat-error"),c(1,"Invalid email format."),o())}function Je(r,i){r&1&&(s(0,"mat-error"),c(1,"Password is required."),o())}function Ke(r,i){r&1&&(s(0,"mat-error"),c(1,"Name is required."),o())}function Qe(r,i){if(r&1&&(s(0,"mat-form-field",4)(1,"mat-label"),c(2,"Name"),o(),p(3,"input",12),d(4,Ke,2,0,"mat-error",6),o()),r&2){let e=C();l(4),u("ngIf",e.authForm.controls.name.hasError("required"))}}function et(r,i){if(r&1&&(s(0,"div",13),c(1),o()),r&2){let e=C();l(),T(e.errorMessage)}}var ze=(()=>{class r{fb;signalrService;authService;apiAuthService;errorMessage="";isRegisterMode=!1;authForm;constructor(e,t,n,a){this.fb=e,this.signalrService=t,this.authService=n,this.apiAuthService=a}ngOnInit(){this.initialForm()}initialForm(){this.authForm=this.fb.group({email:["",[L.required,L.email]],password:["",L.required],name:[""]})}ngOnDestroy(){}onSubmit(){if(!this.authForm.invalid)if(this.isRegisterMode){let e=new ye(this.authForm.value.email,this.authForm.value.password,this.authForm.value.name);this.registerAPI(e)}else this.loginAPI(this.authForm.value.email,this.authForm.value.password)}toggleMode(){this.isRegisterMode=!this.isRegisterMode}loginAPI(e,t){this.apiAuthService.login(e,t).subscribe({next:n=>{this.authorizeUser(n.token)},error:n=>this.errorMessage="Login failed. Please check your credentials."})}registerAPI(e){this.apiAuthService.register(e).subscribe({next:t=>{this.authorizeUser(t.token)},error:t=>this.errorMessage="Registration failed. Please try again."})}authorizeUser(e){localStorage.setItem("token",e),this.authService.launchHub(e),this.apiAuthService.checkAuthentication();let t=this.apiAuthService.getUserRole();t&&(t==="1"?this.authService.router.navigate(["/display-connection-status"]):this.authService.router.navigate(["/edit-products"]))}static \u0275fac=function(t){return new(t||r)(h(Me),h(b),h(N),h(f))};static \u0275cmp=I({type:r,selectors:[["app-auth"]],standalone:!0,features:[F],decls:23,vars:10,consts:[["fxLayout","column","fxLayoutAlign","center center",2,"width","300px","margin","auto"],[3,"ngSubmit","formGroup"],["fxLayout","column"],["fxLayout","column","fxLayoutAlign","center center"],["appearance","fill"],["matInput","","formControlName","email","placeholder","Email"],[4,"ngIf"],["matInput","","formControlName","password","type","password","placeholder","Password"],["appearance","fill",4,"ngIf"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["style","color: red;",4,"ngIf"],["matInput","","formControlName","name","placeholder","Name"],[2,"color","red"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"h2"),c(2),o(),s(3,"form",1),y("ngSubmit",function(){return n.onSubmit()}),s(4,"div",2)(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),c(8,"Email"),o(),p(9,"input",5),d(10,Ze,2,0,"mat-error",6)(11,Xe,2,0,"mat-error",6),o(),s(12,"mat-form-field",4)(13,"mat-label"),c(14,"Password"),o(),p(15,"input",7),d(16,Je,2,0,"mat-error",6),o(),d(17,Qe,5,1,"mat-form-field",8),o(),s(18,"button",9),y("click",function(){return n.toggleMode()}),c(19),o(),s(20,"button",10),c(21),o()(),d(22,et,2,1,"div",11),o()()),t&2&&(l(2),T(n.isRegisterMode?"Register":"Login"),l(),u("formGroup",n.authForm),l(7),u("ngIf",n.authForm.controls.email.hasError("required")),l(),u("ngIf",n.authForm.controls.email.hasError("email")),l(5),u("ngIf",n.authForm.controls.password.hasError("required")),l(),u("ngIf",n.isRegisterMode),l(2),H(" ",n.isRegisterMode?"Already have an account? Login":"Need an account? Register"," "),l(),u("disabled",n.authForm.invalid),l(),H(" ",n.isRegisterMode?"Register":"Login"," "),l(),u("ngIf",n.errorMessage))},dependencies:[D,R,Fe,xe,_e,Ie,Re,we,M,E,Ee,ke,Le,De,Pe]})}return r})();var Oe=[{path:"",redirectTo:"auth",pathMatch:"full"},{path:"auth",component:ze},{path:"display-products",loadChildren:()=>import("./chunk-KGGJ37U7.js").then(r=>r.DisplayProductModule),canActivate:[P]},{path:"edit-products",loadChildren:()=>import("./chunk-7V3WL5EO.js").then(r=>r.EditProductModule),canActivate:[P]},{path:"display-connection-status",loadChildren:()=>import("./chunk-A55AKSMP.js").then(r=>r.DisplayConnectionStatusModule),canActivate:[P]},{path:"**",redirectTo:"auth",pathMatch:"full"}];var tt="@",it=(()=>{let i=class i{constructor(t,n,a,m,g){this.doc=t,this.delegate=n,this.zone=a,this.animationType=m,this.moduleImpl=g,this._rendererFactoryPromise=null,this.scheduler=j(K,{optional:!0}),this.loadingSchedulerFn=j(rt,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){let t=()=>this.moduleImpl??import("./chunk-OFHUWDBB.js").then(a=>a),n;return this.loadingSchedulerFn?n=this.loadingSchedulerFn(t):n=t(),n.catch(a=>{throw new B(5300,!1)}).then(({\u0275createEngine:a,\u0275AnimationRendererFactory:m})=>{this._engine=a(this.animationType,this.doc);let g=new m(this.delegate,this._engine,this.zone);return this.delegate=g,g})}createRenderer(t,n){let a=this.delegate.createRenderer(t,n);if(a.\u0275type===0)return a;typeof a.throwOnSyntheticProps=="boolean"&&(a.throwOnSyntheticProps=!1);let m=new O(a);return n?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(g=>{let Ge=g.createRenderer(t,n);m.use(Ge),this.scheduler?.notify(10)}).catch(g=>{m.use(a)}),m}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};i.\u0275fac=function(n){J()},i.\u0275prov=S({token:i,factory:i.\u0275fac});let r=i;return r})(),O=class{constructor(i){this.delegate=i,this.replay=[],this.\u0275type=1}use(i){if(this.delegate=i,this.replay!==null){for(let e of this.replay)e(i);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(i,e){return this.delegate.createElement(i,e)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}get destroyNode(){return this.delegate.destroyNode}appendChild(i,e){this.delegate.appendChild(i,e)}insertBefore(i,e,t,n){this.delegate.insertBefore(i,e,t,n)}removeChild(i,e,t){this.delegate.removeChild(i,e,t)}selectRootElement(i,e){return this.delegate.selectRootElement(i,e)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,e,t,n){this.delegate.setAttribute(i,e,t,n)}removeAttribute(i,e,t){this.delegate.removeAttribute(i,e,t)}addClass(i,e){this.delegate.addClass(i,e)}removeClass(i,e){this.delegate.removeClass(i,e)}setStyle(i,e,t,n){this.delegate.setStyle(i,e,t,n)}removeStyle(i,e,t){this.delegate.removeStyle(i,e,t)}setProperty(i,e,t){this.shouldReplay(e)&&this.replay.push(n=>n.setProperty(i,e,t)),this.delegate.setProperty(i,e,t)}setValue(i,e){this.delegate.setValue(i,e)}listen(i,e,t){return this.shouldReplay(e)&&this.replay.push(n=>n.listen(i,e,t)),this.delegate.listen(i,e,t)}shouldReplay(i){return this.replay!==null&&i.startsWith(tt)}},rt=new V("");function Ue(r="animations"){return ee("NgAsyncAnimations"),q([{provide:Q,useFactory:(i,e,t)=>new it(i,e,t,r),deps:[oe,le,Y]},{provide:Z,useValue:r==="noop"?"NoopAnimations":"BrowserAnimations"}])}var Be=(r,i)=>{let e=localStorage.getItem("token");if(e){let t=r.clone({setHeaders:{Authorization:`Bearer ${e}`}});return i(t)}return i(r)};var Ve={providers:[ne({eventCoalescing:!0}),ge(Oe,ve(fe)),he(),Ue(),ae(ce(),se([Be])),G(Se)]};function nt(r,i){if(r&1){let e=te();s(0,"div",8)(1,"div",9)(2,"a",10),c(3,"Display"),o(),s(4,"a",11),c(5,"Edit"),o(),s(6,"a",12),c(7,"User Status Connections"),o()(),s(8,"div",13)(9,"a",14),y("click",function(){W(e);let n=C();return $(n.authService.logout())}),c(10," Logout "),o()()()}}function ot(r,i){r&1&&(s(0,"div",15)(1,"div",16),p(2,"router-outlet"),o()())}function at(r,i){r&1&&(s(0,"div",17),p(1,"router-outlet"),o())}var qe=(()=>{class r{appService;authService;apiAuthService;signalrService;subscriptions=[];isAuthorized=!1;isAuthPage=!1;constructor(e,t,n,a){this.appService=e,this.authService=t,this.apiAuthService=n,this.signalrService=a}ngOnInit(){typeof window<"u"&&(this.apiAuthService.checkAuthentication(),this.subscriptions.push(this.apiAuthService.isAuthenticatedSubject$.subscribe(e=>{if(this.isAuthorized=e,e){this.authService.router.navigate(["/edit-products"]);let t=localStorage.getItem("token");this.signalrService.hubConnection||this.authService.launchHub(t)}}))),this.authService.router.events.pipe(U(e=>e instanceof me)).subscribe(e=>{let t=["/auth"];this.isAuthPage=t.includes(e.urlAfterRedirects)})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onResize(e){this.checkWindowSize()}checkWindowSize(){this.appService.isMobileMode.set(window.innerWidth<800)}static \u0275fac=function(t){return new(t||r)(h(je),h(N),h(f),h(b))};static \u0275cmp=I({type:r,selectors:[["app-root"]],hostBindings:function(t,n){t&1&&y("resize",function(m){return n.onResize(m)},!1,X)},standalone:!0,features:[F],decls:10,vars:3,consts:[["authPageLayout",""],["fxFlexFill","","fxLayout","column"],["fxFlex","80px","fxLayoutAlign","space-around center",4,"ngIf"],["fxFlex","100%","fxLayout","column","style","overflow: auto;",4,"ngIf","ngIfElse"],["fxLayout","column"],["fxLayout","row"],["fxFlex","90"],["fxFlexAlign","center"],["fxFlex","80px","fxLayoutAlign","space-around center"],["fxFlex","","fxLayoutAlign","space-evenly center"],["routerLink","/display-products",1,"router-link"],["routerLink","/edit-products",1,"router-link"],["routerLink","/display-connection-status",1,"router-link"],["fxFlex","100px","fxLayoutAlign","center"],[2,"cursor","pointer",3,"click"],["fxFlex","100%","fxLayout","column",2,"overflow","auto"],["fxFlex","",2,"margin","1%"],["fxFlex","100%","fxLayout","column","fxLayoutAlign","center center",2,"height","100vh"]],template:function(t,n){if(t&1&&(s(0,"div",1),d(1,nt,11,0,"div",2)(2,ot,3,0,"div",3)(3,at,2,0,"ng-template",null,0,re),s(5,"footer",4)(6,"div",5),p(7,"hr",6),o(),s(8,"p",7),c(9,"Copyright \xA9 2024 Product Store System API"),o()()()),t&2){let a=ie(4);l(),u("ngIf",n.isAuthorized),l(),u("ngIf",!n.isAuthPage)("ngIfElse",a)}},dependencies:[de,D,R,M,E,Ce,be,Ae,pe,Ne]})}return r})();ue(qe,Ve).catch(r=>console.error(r));
